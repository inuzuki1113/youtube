name: Build Nico3DSStream

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # リポジトリをチェックアウト
      - name: Checkout repository
        uses: actions/checkout@v3

      # devkitPro 環境をセットアップ（公式 Action 使用）
      - name: Setup devkitPro
        uses: devkitPro/setup-devkitpro@v2
        with:
          tools: devkitARM

      # 必要なライブラリをクローン
      - name: Clone Libraries
        run: |
          git clone https://github.com/devkitPro/ctru.git /tmp/ctru
          git clone https://github.com/devkitPro/sf2dlib.git /tmp/sf2dlib
          git clone https://github.com/devkitPro/citro3d.git /tmp/citro3d

      # ビルド
      - name: Build .3dsx
        run: |
          cd source
          make
          mkdir -p ../build
          cp Nico3DSStream.3dsx ../build/

      # ビルド成果物をアップロード
      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: Nico3DSStream-3dsx
          path: build/Nico3DSStream.3dsx
